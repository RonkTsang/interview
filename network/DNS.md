# DNS解析

> DNS（Domain Name System）位于 TCP / IP 协议族的**应用层**，是一种组织成域层次结构的计算机和网络服务命名系统，它所提供的服务是用来**将主机名和域名转换为IP地址**的工作

# 解析过程

- 查找 **浏览器缓存**

  浏览器会检查缓存中有没有这个域名对应的解析过的IP地址，如果缓存中有，这个解析过程就将结束。
  
  浏览器缓存域名也是有限制的，不仅浏览器缓存大小有限制，而且缓存的时间也有限制，通常情况下为几分钟到几小时不等

- 查找**系统缓存**

  如果用户的浏览器缓存中没有，浏览器会查找操作系统缓存中是否有这个域名对应的DNS解析结果

- 查找**路由器缓存**

  如果系统缓存中也找不到，那么查询请求就会发向路由器，它一般会有自己的DNS缓存。

- 查找**ISP DNS 缓存**

  在我们的网络配置中都会有"DNS服务器地址"这一项，操作系统会把这个域名发送给这里设置的DNS，也就是本地区的域名服务器，通常是提供给你接入互联网的应用提供商。
  
  这个专门的域名解析服务器性能都会很好，它们一般都会缓存域名解析结果，当然缓存时间是受域名的失效时间控制的，一般缓存空间不是影响域名失效的主要因素。大约80%的域名解析都到这里就已经完成了，所以ISP DNS主要承担了域名的解析工作。

- **递归搜索**

  最无奈的情况发生了, 在前面都没有办法命中的DNS缓存的情况下
  
  - (1) 本地 DNS 服务器即将该请求转发到互联网上的根域（即一个完整域名最后面的那个点，通常省略不写）
  - (2) 根域将所要查询域名中的顶级域（假设要查询 ke.qq.com ，该域名的顶级域就是 com ）的服务器 IP 地址返回到本地 DNS 
  - (3) 本地 DNS 根据返回的IP地址，再向顶级域（就是 com 域）发送请求
  - (4) com 域服务器再将域名中的二级域（即 ke.qq.com 中的 qq ）的 IP 地址返回给本地DNS
  - (5) 本地 DNS 再向二级域发送请求进行查询
  - (6) 之后不断重复这样的过程，直到本地 DNS 服务器得到最终的查询结果，并返回到主机。
  
  这时候主机才能通过域名访问该网站。


# 预解析

  可以通过用meta信息来告知浏览器, 我这页面要做DNS预解析
  ``` html
  <meta http-equiv="x-dns-prefetch-control" content="on" />
  ```
可以使用link标签来强制对DNS做预解析:
  ``` html
  <link rel="dns-prefetch" href="http://ke.qq.com/" />
  ```
# 参考

  - [ DNS 解析](http://imweb.io/topic/55e3ba46771670e207a16bc8)